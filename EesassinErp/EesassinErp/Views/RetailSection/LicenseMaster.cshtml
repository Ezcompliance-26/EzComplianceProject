@{
    ViewBag.Version = System.Configuration.ConfigurationManager.AppSettings["version"];
    ViewBag.Title = "Dashboard";
    Layout = "~/Views/Common/_RetailLayout.cshtml";
}

<style>
    .red-validation {
        border: 1px solid red;
        background-color: #ffe6e6;
    }

    .table-container {
        overflow-x: auto;
    }

    .validation-msg {
        color: red;
        font-size: 12px;
        margin-top: 5px;
    }

    .table-container table {
        border-collapse: separate;
        border-spacing: 0;
    }

    /* Set the position of the first column to sticky (frozen) */
    .table-container th:first-child,
    .table-container td:first-child {
        position: sticky;
        left: 0;
        z-index: 1;
        background-color: #fff;
        box-shadow: 6px 0 5px -5px rgba(0, 0, 0, 0.2);
    }

    /* Adjust padding and height to align with other columns */
    .table-container th:first-child,
    .table-container td:first-child {
        padding: 8px;
        height: 50px;
    }

    /* Set the position of the last column (Make Payment) to sticky (frozen) */
    .table-container th:last-child,
    .table-container td:last-child {
        position: sticky;
        right: 0;
        z-index: 1;
        background-color: #fff;
        box-shadow: -6px 0 5px -5px rgba(0, 0, 0, 0.2);
    }

    /* Adjust padding and height to align with other columns */
    .table-container th:last-child,
    .table-container td:last-child {
        padding: 8px;
        height: 50px;
    }
</style>
<script>
    function changedateformat(val) {
        alert(val)
        const myArray = val.split("-");

        let year = myArray[0];
        let month = myArray[1];
        let day = myArray[2];

        let formatteddate = day + "-" + month + "-" + year;
        alert(formatteddate)
        return formatteddate;
    }
</script>
<div class="pagecontentbody">
    <div class="pagebody">
        <div class="col-md-12 pageheader pb-2">
            <div class="row">
                <div class="col-md-9">
                    <h4 class="mb-0"></h4>
                </div>
                <div class="col-sm-3 text-end" ng-if="loginType==1">
                    <a class="btn btn-warning" href="@Url.Action("licenseMasterBulkP","RetailSection")">Make bulk payment</a>
                </div>
            </div>
        </div>
        <div class="col-md-12">
            <div class="row mb-3 p-3 pt-0">
                <div class="card p-0">
                    <div class="card-header">
                        <div class="row">
                            <div class="col-md-10">
                                <ul class="nav nav-tabs" id="myTab" role="tablist">
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link active" id="tab1-tab" data-bs-toggle="tab" data-bs-target="#tab1" type="button" role="tab" aria-controls="tab1" aria-selected="true">View</button>
                                    </li>
                                    @*<li class="nav-item" role="presentation">
                                        <button class="nav-link" id="tab2-tab" data-bs-toggle="tab" data-bs-target="#tab2" type="button" role="tab" aria-controls="tab2" aria-selected="false">Import</button>
                                    </li>*@
                                </ul>
                            </div>
                            <div class="col-md-2 text-end">
                                <a class="btn btn-primary expbtn dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false" style="margin-top: 2px;">Export</a>
                                <ul class="dropdown-menu escalul" aria-labelledby="escalbtnLink">
                                    <li><a class="dropdown-item" ng-click="ExportExcel()">Export in Excel</a></li>
                                    <li><a class="dropdown-item" ng-click="ExportPdf();">Export in PDF</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="tab-content" id="myTabContent">
                            <div class="tab-pane fade show active" id="tab1" role="tabpanel" aria-labelledby="tab1-tab">
                                <div class="row mb-3">
                                    <div class="col-md-9 mt-3">
                                        <ul class="filter-search">
                                            <li class="p-0">
                                                <div class="input-group">
                                                    <input class="form-control" type="text" id="myInput" value="" placeholder="Search">
                                                    <button class="btn btn-default" type="button" id="button-addon2"><span class="icons icon-magnifier"></span></button>
                                                </div>
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="col-md-3 mt-3">
                                        <ul class="btngroup">
                                            <li></li>
                                            <li class="nav-item submenu">
                                                <a class="btn btn-default" href="#" id="A1">Sort by <span class="fa fa-arrow-down"></span></a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="table-responsive nosearch" ng-init="BindExecuter()">
                                    <table id="example" class="table table-bordred table-hover unittbl tableFixHead">
                                        <thead class="bg-warning text-white">
                                            <tr>
                                                <th>S.No.</th>
                                                <th width="12%">Store Code</th>
                                                <th width="12%">Ref Store Code</th>
                                                <th>Store Address</th>
                                                <th>Proposed Date</th>
                                                <th>License Name</th>
                                                <th>License Type</th>
                                                <th>Requested Date</th>
                                                <th>Doc. Date </th>
                                                <th>Application Status </th>
                                                <th>Application Date </th>
                                                <th>Upload Application Copy </th>
                                                <th>Upload Challan Copy</th>
                                                <th>Upload Fees Copy </th>
                                                <th>License  Status </th>
                                                <th>License Date </th>
                                                <th>License Number </th>
                                                <th>Validity Start Date </th>
                                                <th>Validity End Date</th>
                                                <th>Upload License Copy</th>
                                                <th>Renewal Request Date</th>
                                                <th>Renewal Status</th>
                                                <th>Renewal Start Date</th>
                                                <th>Renewal End date</th>
                                                <th>Upload Renewed License</th>
                                                <th>UserName</th>
                                                <th>Password</th>
                                                <th>Mobile No.</th>
                                                <th>Email ID.</th>
                                                <th>Tentative Date of Comp.</th>
                                                <th>Invoice Status</th>
                                                <th>Invoice Date</th>
                                                <th>Invoice No.</th>
                                                <th> Invoice Amount<br />(To be paid net of TDS)</th>
                                                <th>Upload Invoice</th>
                                                <th>Payment Status</th>
                                                <th>Payment TAT</th>
                                                <th>Payment Due Date</th>
                                                <th>Over Due Day</th>
                                                <th ng-if="loginType==1">Make Payment</th>
                                                <th ng-if="loginType==1">Action</th>
                                            </tr>
                                        </thead>
                                        <tbody id="myTable">

                                            <tr ng-repeat="license in LicenseRequestList" ng-disabled="{{IsValid}}">
                                                <td>{{ $index + 1 }}</td>
                                                <td><b>{{license.StoreCode}}</b></td>
                                                <td><b>{{license.RefStoreCode}}</b></td>
                                                <td>{{license.StoreAddress}}</td>
                                                <td>{{license.ProposedDate}}</td>
                                                <td>{{license.LicenseName}}</td>
                                                <td>{{license.LicenseType}}</td>
                                                <td>{{license.RequestedDate}}</td>
                                                <td>{{license.DocumentDate}}</td>
                                                <td>
                                                    <select style="width:auto" class="form-select form-control validate" id="ApplicationStatus{{$index}}" ng-model="license.ApplicationStatus" ng-change="onStatusChange(license)" ng-disabled="{{IsValid}}">
                                                        <option value="">Select</option>
                                                        <option ng-repeat="item in ApplicationStatusList" value="{{item.AttributeValue}}">{{item.AttributeValue}}</option>
                                                    </select>
                                                </td>
                                                <td>
                                                    <input style="width:auto" date-input type="date" class="form-control" id="ApplicationDate{{$index}}" ng-model="license.ApplicationDate" ng-class="{'validate': license.ApplicationDateInvalid}" ng-disabled="{{IsValid}}" />
                                                </td>
                                                <td>
                                                    <div id="UploadApplicationCopy{{$index}}" ng-disabled="{{IsValid}}">
                                                        <label class="vdoc" ng-hide="license.LStatus==2||license.LStatus==4||{{loginType}}==4">
                                                            Browse&nbsp;
                                                            <input id="license{{$index+1}}" class="pagerlink" type="file" style="display:none" ng-model="license.UploadApplicationCopy" onchange="angular.element(this).scope().uploadFile('UploadApplicationCopy', this)" ng-required="isChallanCopyMandatory" />
                                                        </label>
                                                        <a ng-show="license.UploadApplicationCopy||license{{$index+1}}=='1'" ng-click="viewDocument(license.UploadApplicationCopy)">
                                                            <i class="fa fa-download"></i>
                                                        </a>
                                                    </div>


                                                </td>
                                                <td>
                                                    <div id="ChallanCopy{{$index}}" ng-disabled="{{IsValid}}">
                                                        <label class="vdoc" ng-hide="license.LStatus==2||license.LStatus==4||{{loginType}}==4">
                                                            Browse&nbsp;
                                                            <input id="UploadChallanCopy{{$index+1}}" type="file" style="display:none" ng-model="license.UploadChallanCopy" onchange="angular.element(this).scope().uploadFile('UploadChallanCopy', this)" ng-required="isChallanCopyMandatory" />
                                                        </label>
                                                        <a ng-show="license.UploadChallanCopy||UploadChallanCopy{{$index+1}}=='1'" ng-click="viewDocument(license.UploadChallanCopy)">
                                                            <i class="fa fa-download"></i>
                                                        </a>
                                                    </div>
                                                </td>

                                                <td>
                                                    <div id="FeesCopy{{$index+1}}" ng-disabled="{{IsValid}}">
                                                        <label class="vdoc" ng-hide="license.LStatus==2||license.LStatus==4||{{loginType}}==4">
                                                            Browse&nbsp;
                                                            <input id="UploadFeesCopy{{$index+1}}" type="file" style="display:none" ng-model="license.UploadFeesCopy" onchange="angular.element(this).scope().uploadFile('UploadFeesCopy', this)" />
                                                        </label>

                                                        <a ng-show="license.UploadFeesCopy||UploadFeesCopy{{$index+1}}=='1'" ng-click="viewDocument(license.UploadFeesCopy)">
                                                            <i class="fa fa-download"></i>
                                                        </a>


                                                    </div>
                                                </td>
                                                <td>
                                                    <select style="width:auto" ng-model="license.LicenseStatus" id="LicenseStatus{{$index}}" class="form-select form-control validate" ng-disabled="{{IsValid}}">
                                                        <option value="">Select</option>
                                                        <option ng-repeat="item in LicenseStatusList" value="{{item.AttributeValue}}">{{item.AttributeValue}}</option>
                                                    </select>
                                                </td>

                                                <td><input date-input type="date" class="form-control" style="width:auto" id="IssuedDate{{$index}}" ng-model="license.IssuedDate" ng-disabled="{{IsValid}}" ng-change="LDate($index)" /></td>
                                                <td>  <input type="text" class="form-control" style="width:auto" ng-model="license.LicenseNumber" id="LicenseNumber{{$index}}" ng-disabled="{{IsValid}}"></td>
                                                <td><input date-input type="date" style="width:auto" class="form-control" ng-model="license.ValidityStartDate" id="ValidityStartDate{{$index}}" ng-disabled="{{IsValid}}" /></td>
                                                <td><input date-input type="date" style="width:auto" class="form-control" ng-model="license.ValidityEndDate" id="ValidityEndDate{{$index}}" ng-disabled="{{IsValid}}" ng-change="SetDate($index)" /></td>
                                                <td>

                                                    <div ng-disabled="{{IsValid}}">

                                                        <label class="vdoc" ng-hide="license.LStatus==2||license.LStatus==4||{{loginType}}==4">
                                                            Browse&nbsp;
                                                            <input id="UploadLicenseCopy{{$index+1}}" type="file" style="display:none" ng-model="UploadLicenseCopy" onchange="angular.element(this).scope().uploadFile('UploadLicenseCopy', this)" />
                                                        </label>
                                                        <a ng-show="license.UploadLicenseCopy||UploadLicenseCopy{{$index+1}}=='1'" ng-click="viewDocument(license.UploadLicenseCopy)">
                                                            <i class="fa fa-download"></i>
                                                        </a>
                                                    </div>
                                                </td>

                                                <td><input type="text" class="form-control" readonly ng-model="license.RenewalRequestDate" /></td>
                                                <td>
                                                    <p ng-show="license.LStatus==4">{{license.RenewalStatus}}</p>
                                                    <select style="width:auto" ng-model="license.RenewalStatus" class="form-select form-control validate" ng-disabled="{{IsValid}}" ng-show="license.LStatus==3">
                                                        <option value="">Select</option>
                                                        <option value="Renew">Renew</option>
                                                        <option value="NonRenew">Non Renew</option>
                                                    </select>
                                                </td>
                                                <td>
                                                    <input type="date" style="width:auto" class="form-select form-control " ng-model="license.RenewalStartDate" ng-show="license.LStatus==4" />
                                                    <input date-input type="date" style="width:auto" class="form-control" id="RenewalStartDate{{$index}}" ng-model="license.RenewalStartDate" ng-disabled="{{IsValid}}" ng-show="license.LStatus==3" />
                                                </td>
                                                <td>
                                                    <input date-input type="date" class="form-select form-control " style="width:auto" ng-model="license.RenewalEnddate" ng-show="license.LStatus==4||license.LStatus==3" ng-disabled="{{IsValid}}" />

                                                    @*<input date-input type="date" class="form-control" id="RenewalEnddate{{$index+1}}" ng-model="license.RenewalEndDate" ng-show="" />*@
                                                </td>
                                                <td>
                                                    <div ng-disabled="{{IsValid}}">
                                                        <label class="vdoc" ng-if="loginType==1" ng-show="license.LStatus==4||license.LStatus==3">
                                                            Browse&nbsp;
                                                            <input id="UploadRenewedCopy{{$index+1}}" type="file" style="display:none" ng-model="UploadRenewedCopy" onchange="angular.element(this).scope().uploadFile('UploadRenewedCopy', this)" />
                                                        </label>

                                                        <div ng-If="license.UploadRenewedCopy.length>0">
                                                            <a ng-show="license.UploadRenewedCopy !='null'||UploadRenewedCopy{{$index+1}}=='1'" ng-click="viewDocument(license.UploadRenewedCopy)">
                                                                <i class="fa fa-download"></i>
                                                            </a>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td>  <input type="text" style="width:auto" class="form-control" ng-model="license.UserName" ng-disabled="{{IsValid}}"></td>
                                                <td>  <input type="text" style="width:auto" class="form-control" ng-model="license.UserPassword" ng-disabled="{{IsValid}}"></td>
                                                <td>  <input id="MobileNumber{{$index}}" style="width:auto" type="text" class="form-control" ng-model="license.MobileNumber" onKeyUp="$(this).val($(this).val().replace(/[^\d]/ig, ''))" numeric-only dynamic-length maxlength="10" minlength="10" ng-disabled="{{IsValid}}"></td>
                                                <td>  <input type="text" id="Email{{$index}}" style="width:auto" class="form-control" ng-model="license.EmailId" ng-disabled="{{IsValid}}"></td>
                                                <td><input date-input type="date" class="form-control" style="width:auto" ng-model="license.TentativeDateofComp" ng-disabled="{{IsValid}}" /></td>

                                                <td>
                                                    <select style="width:auto" ng-model="license.InvoiceStatus" id="InvoiceStatus{{$index}}" class="form-select form-control validate" ng-disabled="{{IsValid}}">
                                                        <option value="">Select</option>
                                                        <option ng-repeat="item in InvoiceStatusList" value="{{item.AttributeValue}}">{{item.AttributeValue}}</option>
                                                    </select>
                                                </td>
                                                <td>

                                                    <input style="width:auto" date-input type="date" class="form-control" id="InvoiceDate{{$index}}" ng-model="license.InvoiceDate" ng-disabled="{{IsValid}}" />

                                                </td>
                                                <td>
                                                    <div>
                                                        <input style="width:auto" type="text" class="form-control" id="InvoiceNo{{$index}}" ng-model="license.InvoiceNo" ng-disabled="{{IsValid}}" />

                                                    </div>
                                                    <div>

                                                    </div>
                                                </td>
                                                <td>
                                                    <input style="width:auto" type="text" ng-disabled="{{IsValid}}" class="form-control" id="InvoiceAmount{{$index}}" ng-model="license.InvoiceAmount" onKeyUp="$(this).val($(this).val().replace(/[^\d]/ig, ''))">
                                                </td>
                                                <td>
                                                    <div ng-disabled="{{IsValid}}">
                                                        <label class="vdoc" id="InvoiceCopy{{$index}}" ng-hide="license.LStatus==2||license.LStatus==4||{{loginType}}==4">
                                                            Browse&nbsp;
                                                            <input id="UploadInvoice{{$index+1}}" type="file" style="display:none" ng-model="license.UploadInvoice" onchange="angular.element(this).scope().uploadFile('UploadInvoice', this)" />
                                                        </label>
                                                        <a ng-show="license.UploadInvoice||UploadInvoice{{$index+1}}=='1'" ng-click="viewDocument(license.UploadInvoice)">
                                                            <i class="fa fa-download"></i>
                                                        </a>
                                                    </div>
                                                </td>
                                                <td>
                                                    <select ng-model="license.PaymentStatus " class="form-select form-control validate" ng-disabled="true">
                                                        <option value="">Select</option>
                                                        <option value="Paid">Paid</option>
                                                        <option value="Unpaid">Unpaid</option>
                                                    </select>
                                                </td>
                                                <td>
                                                    <input type="text" class="form-control" ng-model="license.PaymentTAT" ng-disabled="{{IsValid}}" onKeyUp="$(this).val($(this).val().replace(/[^\d]/ig, ''))">
                                                </td>
                                                <td><input type="text" class="form-control" ng-disabled="true" ng-model="license.PaymentDueDate" /> </td>
                                                <td><input class="form-control" ng-disabled="true" ng-model="license.PaymentOverDueDate" /></td>

                                                <td><a ng-show="{{loginType}}==1 && license.PaymentStatus=='Unpaid'" class="btn btn-warning" ng-Click="RedirectTocheckout(license)">PaymentLink</a></td>
                                                <td><a class="btn btn-warning" ng-click="SubmitLicense(license,$index)" ng-hide="license.LStatus==2||license.LStatus==4||{{loginType}}==4">Save</a></td>

                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-md-12">
                                        <a class="btn-view" ng-click="ViewAllClicked()">View All</a>
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="tab2" role="tabpanel" aria-labelledby="tab2-tab">
                                <div class="py-5 mt-3 text-center">
                                    <a class="btn btn-warning btn-lg"><span class="fas fa-download"></span>&nbsp;&nbsp;Download Department Sheet</a>
                                </div>
                                <div class="dropbg">
                                    <form method="post" action="/upload">
                                        <div class="row">
                                            <div class="col-md-5 text-center">
                                                <img src="~/compliance/images/dropf.png" />
                                            </div>
                                            <div class="col-md-7">
                                                <h4 class="mt-5">Drop or Select files</h4>
                                                <p>
                                                    Drop files here or click
                                                    <input type="file" multiple>
                                                    to select thorough your machine Accepted files type:.xlsx
                                                </p>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="~/scripts/RetailJsLib/LicenseRequestMasterController.js"></script>
<script src="~/Content/lib/moment/moment.js"></script>